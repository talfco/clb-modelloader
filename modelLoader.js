// Generated by CoffeeScript 1.4.0
(function(){var e,t,n;n=require("underscore");t=require("winston");module.exports=e=function(){function e(){}e.prototype.autoload=function(e,r,i){var s,o,u,a,f=this;o=require("fs");a=require("path");t.info("Loading models from path "+i);s=o.readdirSync(i);u=n.map(s,function(e){return a.basename(e)});return n.each(u,function(n){var r,s,o;if(n!==void 0){o=".coffee";if(n.indexOf(o,n.length-o.length)!==-1){s=require(i+"/"+n);t.info("Creating mogoose object for: "+n);r=new s;return f.expose(r,e)}}})};e.prototype.expose=function(e,n){var r;r=e.getCollection();t.info("ModelLoader: installing request handlers for /"+r);n.get("/"+r,function(n,i){t.info("ModelLoader: GET for  "+r+" received, sending the collection for "+e.getDBModel().modelName);return e.getDBModel().find({},function(e,n){t.info("JSON Data",n);return e!==null?i.json(e,500):i.send(n)})});n.get("/"+r+"/:id",function(n,i){var s;t.info("ModelLoader: GET received for "+r+"  model "+n.params.id);s={_id:n.params.id};return e.getDBModel().find(s,function(e,n){t.info("JSON Data",n);return e!==null?i.json(e,500):i.send(n)})});n.put("/"+r+"/:id",function(n,r){var i,s;t.info("ModelLoader: PUT received for model "+n.params.id);t.info("JSON Data received ",n.body);i={_id:n.params.id};s=n.body;delete s._id;return e.getDBModel().update(i,s,{},function(e,n){t.info("ModelLoader: Update done on "+n+" row - errors: "+e);return e===null?r.send(s):r.json(e,500)})});n.del("/"+r+"/:id",function(n,r){var i;t.info("ModelLoader: DELETE received for model "+n.params.id);i={_id:n.params.id};return e.getDBModel().remove(i,function(e,n){t.info("ModelLoader: Delete done on "+n+" row - errors: "+e);return e===null?r.json(200):r.json(e,500)})});return n.post("/"+r,function(n,i){var s,o,u;t.info("ModelLoader: POST received for model "+r);t.info("JSON Data received ",n.body);s={_id:n.params.id};o=n.body;u=e.newInstance(o);t.info("ModelLoader: Save to dbmodel "+e.getModelName());u.save();t.info("ModelLoader: New record created");t.info("JSON Data",u.model);return i.send(u.model)})};return e}()}).call(this);